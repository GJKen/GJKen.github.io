!function(o,v){o.ApplicationUpdateService={getRunInfo:function(){var e=v.Utils,t=o.Prefs.version,r=e.getAppVersion();e.setAppVersion(t);var i=t!=r,n=t!=r&&r;return!o.userSettings.UpdateFirstRun()&&n&&(i=!1),{isFirstRun:i,isUpdate:n,currentVersion:t,prevVersion:r}},onUpdate:function(e,t){this._executeMethods([]).then(t)},_executeMethods:function(e){var t=new v.vPromise,r=function(){0==e.length?t.resolve():e.shift().call(this).then(r)}.bind(this);return r(),t},_onUpdateToSaveFilterRulesToDifferentFiles:function(){var s=new v.vPromise;return o.FilterStorage.loadFromDisk(function(n){var a=Object.create(null),l=function(){if(0==n.length){v.LocalStorage.setItem("yiclear-filters",JSON.stringify(a));var e=function(){};v.FileStorage.removeFile(o.FilterStorage.FILE_PATH,e,e),s.resolve()}else{var t=n.shift();a[t.filterId]={version:t.version,lastCheckTime:t.lastCheckTime,lastUpdateTime:t.lastUpdateTime,disabled:t.disabled};var r=new v.vPromise,i=v.CollectionUtils.getRulesText(t.filterRules);o.FilterStorage.saveFilterRules(t.filterId,i,r.resolve),r.then(l)}};l()}),s},_onUpdateToMultiplySubscriptions:function(){"yiclear-filters"in v.LocalStorage.storage&&(this._saveInstalledFiltersOnUpdate(),this._saveFiltersVersionInfoOnUpdate(),v.LocalStorage.removeItem("yiclear-filters"));var e=new v.vPromise;return e.resolve(),e},_onUpdateRemoveIpResolver:function(){v.Log;v.LocalStorage.removeItem("ip-cache");var e=new v.vPromise;return e.resolve(),e},_onUpdateWhiteListService:function(){var n=new v.vPromise,e=v.AntiBannerFiltersId.WHITE_LIST_FILTER_ID;return o.FilterStorage.loadFilterRules(e,function(e){var t=[];if(e){for(var r=0;r<e.length;r++)if(/^@@\/\/([^\/]+)\^\$document$/.test(e[r])){var i=RegExp.$1;t.indexOf(i)<0&&t.push(i)}v.LocalStorage.setItem("white-list-domains",JSON.stringify(t)),n.resolve()}else n.resolve()}.bind(this)),n},_onUpdateRuleHitStats:function(){o.filterRulesHitCount.cleanup();var e=new v.vPromise;return e.resolve(),e},_saveInstalledFiltersOnUpdate:function(){var e=o.FilterLSUtils,t=JSON.parse(v.LocalStorage.getItem("yiclear-filters"))||Object.create(null);for(var r in t){var i=t[r];if(r!=v.AntiBannerFiltersId.USER_FILTER_ID&&r!=v.AntiBannerFiltersId.WHITE_LIST_FILTER_ID){var n={filterId:r,loaded:!0};i.disabled||(n.installed=!0,n.enabled=!0),e.updateFilterStateInfo(n)}}},_saveFiltersVersionInfoOnUpdate:function(){var e=o.FilterLSUtils,t=JSON.parse(v.LocalStorage.getItem("yiclear-filters"))||Object.create(null);for(var r in t){var i=t[r],n={filterId:r,version:i.version,lastCheckTime:i.lastCheckTime,lastUpdateTime:i.lastUpdateTime};e.updateFilterVersionInfo(n)}}}}(yiclearAPI,vAPI);