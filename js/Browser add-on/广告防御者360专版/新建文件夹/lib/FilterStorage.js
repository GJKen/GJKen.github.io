!function(l,a){"use strict";l.FilterStorage={FILE_PATH:"filters.ini",CSS_FILE_PATH:"elementsHide.css",_loading:!1,_cssSaving:!1,saveFilterRules:function(e,r,t){var i=a.Log,s=l.FilterStorage._getFilePath(e),n=a.FileStorage;n.write(s,r,function(e){e&&i.error("Error write filters to file {0} cause: {1}",s,n.translateError(e)),t&&t()})},loadFilterRules:function(e,t){var i=a.Log,s=a.FileStorage,n=l.FilterStorage._getFilePath(e);s.read(n,function(e,r){e&&i.error("Error while reading rules from file {0} cause: {1}",n,s.translateError(e)),t(r)}.bind(this))},saveStyleSheetToDisk:function(e,r){if(!this._cssSaving){this._cssSaving=!0;var t=a.Log,i=a.FileStorage,s=l.FilterStorage.CSS_FILE_PATH;i.write(s,e,function(e){e&&e.error?t.error("Error write css styleSheet to file {0} cause: {1}",s,i.translateError(e.error)):(r(),this._cssSaving=!1)}.bind(this))}},loadFromDisk:function(r){var t=a.Log,i=a.FileStorage,s=l.FilterStorage.FILE_PATH,n=new c;i.readFromFileWithListener(s,n,function(e){e&&t.error("Error read filters from file {0} cause: {1}",s,i.translateError(e)),r(n.antiBannerFilters||[])}.bind(this))},_getFilePath:function(e){return"filterrules_"+e+".txt"}};var c=function(){this.currentSection=null,this.currentFilter=null,this.currentRules=null,this.antiBannerFilters=[]};c.Sections={FILTER_START:"[FILTER]",FILTER_END:"[/FILTER]",RULES_START:"[RULES]",RULES_END:"[/RULES]"},c.fromObject=function(e){var r={filterId:e.filterId-0,version:"0.0.0.0"};return"version"in e&&(r.version=e.version),"lastUpdateTime"in e&&(r.lastUpdateTime=e.lastUpdateTime-0),"lastCheckTime"in e&&(r.lastCheckTime=e.lastCheckTime-0),r.disabled="true"==e.disabled,r},c.prototype={process:function(e){var r=l.FilterRuleBuilder;switch(e){case c.Sections.FILTER_START:this.currentFilter=Object.create(null),this.currentSection=c.Sections.FILTER_START;break;case c.Sections.RULES_START:this.currentRules=[],this.currentSection=c.Sections.RULES_START;break;case c.Sections.FILTER_END:if(this.currentFilter){var t=c.fromObject(this.currentFilter);null!==t&&(t.filterRules=this.currentRules,this.antiBannerFilters.push(t))}this.currentFilter=null,this.currentRules=null,this.currentSection=null;break;case c.Sections.RULES_END:break;default:switch(this.currentSection){case c.Sections.FILTER_START:if(e&&this.currentFilter){var i=/^(\w+)=(.*)$/.exec(e);this.currentFilter[i[1]]=i[2]}break;case c.Sections.RULES_START:if(e&&this.currentRules){var s=r.createRule(e,this.currentFilter.filterId-0);null!==s&&this.currentRules.push(s)}}}}}}(yiclearAPI,vAPI);