!function(e,t){"use strict";var o=t.StringUtils,a=t.UrlUtils,d=t.Log,s=t.CollectionUtils;e.BaseFilterRule=function(e,t){this.ruleText=e,this.filterId=t},e.BaseFilterRule.prototype={loadDomains:function(t){if(!o.isEmpty(t)){var e=null,i=null,s=t.split(/[,|]/);try{for(var r=0;r<s.length;r++){var n,l=s[r];o.startWith(l,"~")?(n=a.toPunyCode(l.substring(1).trim()),o.isEmpty(n)||(null==i&&(i=[]),i.push(n))):(n=a.toPunyCode(l.trim()),o.isEmpty(n)||(null==e&&(e=[]),e.push(n)))}}catch(e){d.error("Error load domains from {0}, cause {1}",t,e)}this.setPermittedDomains(e),this.setRestrictedDomains(i)}},getPermittedDomains:function(){return this.permittedDomain?[this.permittedDomain]:this.permittedDomains},getRestrictedDomains:function(){return this.restrictedDomain?[this.restrictedDomain]:this.restrictedDomains},setRedirectUrl:function(e){if(!e||0==e.length)return delete this.RedirectUrl,void delete this.RedirectUrls;1<e.length?(this.RedirectUrls=e,delete this.RedirectUrl):(this.RedirectUrl=e[0],delete this.RedirectUrls)},setReloadUrl:function(e){if(!e||0==e.length)return delete this.ReloadUrl,void delete this.ReloadUrls;1<e.length?(this.ReloadUrls=e,delete this.ReloadUrl):(this.ReloadUrl=e[0],delete this.ReloadUrls)},setCountUrl:function(e){if(!e||0==e.length)return delete this.BCount,void delete this.BCounts;1<e.length?(this.BCounts=e,delete this.BCount):(this.BCount=e[0],delete this.BCounts)},setProxyUrl:function(e){if(!e||0==e.length)return delete this.Proxy,void delete this.Proxys;1<e.length?(this.Proxys=e,delete this.Proxy):(this.Proxy=Proxy[0],delete this.Proxys)},setPermittedDomains:function(e){if(!e||0==e.length)return delete this.permittedDomain,void delete this.permittedDomains;1<e.length?(this.permittedDomains=e,delete this.permittedDomain):(this.permittedDomain=e[0],delete this.permittedDomains)},setRestrictedDomains:function(e){if(!e||0==e.length)return delete this.restrictedDomain,void delete this.restrictedDomains;1<e.length?(this.restrictedDomains=e,delete this.restrictedDomain):(this.restrictedDomain=e[0],delete this.restrictedDomains)},isDomainSensitive:function(){return this.hasRestrictedDomains()||this.hasPermittedDomains()},isGeneric:function(){return!this.hasPermittedDomains()},hasPermittedDomains:function(){return this.permittedDomain||this.permittedDomains&&0<this.permittedDomains.length},hasRestrictedDomains:function(){return this.restrictedDomain||this.restrictedDomains&&0<this.restrictedDomains.length},isPermitted:function(e){return!!e&&((!this.restrictedDomain||!a.isDomainOrSubDomain(e,this.restrictedDomain))&&((!this.restrictedDomains||!a.isDomainOrSubDomainOfAny(e,this.restrictedDomains))&&(!this.hasPermittedDomains()||(!(!this.permittedDomain||!a.isDomainOrSubDomain(e,this.permittedDomain))||a.isDomainOrSubDomainOfAny(e,this.permittedDomains)))))},addRestrictedDomains:function(e){if(e){if(this.hasPermittedDomains()){var t=this;e=e.filter(function(e){return t.isPermitted(e)})}var i=this.getRestrictedDomains();i=s.removeDuplicates((i||[]).concat(e)),this.setRestrictedDomains(i)}},removeRestrictedDomains:function(e){if(e){for(var t=this.getRestrictedDomains(),i=0;i<e.length;i++)s.remove(t,e[i]);this.setRestrictedDomains(t)}}},e.BaseFilterRule.escapeRule=function(e){return encodeURIComponent(e).replace(/'/g,"%27")},e.BaseFilterRule.PARAMETER_START="[",e.BaseFilterRule.PARAMETER_END="]",e.BaseFilterRule.MASK_WHITE_LIST="@@",e.BaseFilterRule.MASK_CONTENT_RULE="$$",e.BaseFilterRule.MASK_CSS_RULE="##",e.BaseFilterRule.MASK_CSS_EXCEPTION_RULE="#@#",e.BaseFilterRule.MASK_CSS_INJECT_RULE="#$#",e.BaseFilterRule.MASK_CSS_INJECT_RULE_ABP="#?#",e.BaseFilterRule.MASK_CSS_EXCEPTION_INJECT_RULE="#@$#",e.BaseFilterRule.MASK_SCRIPT_RULE="#%#",e.BaseFilterRule.MASK_SCRIPT_EXCEPTION_RULE="#@%#",e.BaseFilterRule.MASK_JS_RULE="%%",e.BaseFilterRule.MASK_BANNER_RULE="++",e.BaseFilterRule.MASK_CONFIGURATION_RULE="~~",e.BaseFilterRule.COMMENT="!",e.BaseFilterRule.EQUAL="=",e.BaseFilterRule.COMA_DELIMITER=",",e.BaseFilterRule.LINE_DELIMITER="|",e.BaseFilterRule.NOT_MARK="~",e.BaseFilterRule.OLD_INJECT_RULES="yiclear_start_style_inject",e.BaseFilterRule.MASK_REDIRECT_RULE="#r#",e.BaseFilterRule.MASK_REDIRECT_EXCEPTION_RULE="#b#"}(yiclearAPI,vAPI);