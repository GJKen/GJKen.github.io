(function(){var s,p,a,h,l,y,d,e,n,r,v,i,t,g=[].slice;p="pending",h="resolved",a="rejected",e=function(n,e){return null!=n?n.hasOwnProperty(e):void 0},r=function(n){return e(n,"length")&&e(n,"callee")},v=function(n){return e(n,"promise")&&"function"==typeof(null!=n?n.promise:void 0)},d=function(n){return r(n)?d(Array.prototype.slice.call(n)):Array.isArray(n)?n.reduce(function(n,e){return Array.isArray(e)?n.concat(d(e)):(n.push(e),n)},[]):[n]},l=function(n,e){return n<=0?e():function(){return--n<1?e.apply(this,arguments):void 0}},i=function(e,r){return function(){var n;return n=[e].concat(Array.prototype.slice.call(arguments,0)),r.apply(this,n)}},y=function(n,e,r){var t,o,u,i,l;for(l=[],o=0,u=(i=d(n)).length;o<u;o++)t=i[o],l.push(t.call.apply(t,[r].concat(g.call(e))));return l},s=function(){var t,r,o,i,l,c,f;return f=p,i=[],l=[],c=[],o={resolved:{},rejected:{},pending:{}},this.promise=function(u){var n,e;return(u=u||{}).state=function(){return f},e=function(n,e,r){return function(){return f===p&&e.push.apply(e,d(arguments)),n()&&y(arguments,o[r]),u}},u.done=e(function(){return f===h},i,h),u.fail=e(function(){return f===a},l,a),u.progress=e(function(){return f!==p},c,p),u.always=function(){var n;return(n=u.done.apply(u,arguments)).fail.apply(n,arguments)},n=function(n,e,r){var t,o;return o=new s,(t=function(n,r,t){return t?u[n](function(){var n,e;return n=1<=arguments.length?g.call(arguments,0):[],e=t.apply(null,n),v(e)?e.done(o.resolve).fail(o.reject).progress(o.notify):o[r](e)}):u[n](o[r])})("done","resolve",n),t("fail","reject",e),t("progress","notify",r),o},u.pipe=n,u.then=n,null==u.promise&&(u.promise=function(){return u}),u},this.promise(this),r=function(n,e,r){return function(){return f===p?(o[f=n]=arguments,y(e,o[n],r),t):this}},(t=this).resolve=r(h,i),this.reject=r(a,l),this.notify=r(p,c),this.resolveWith=function(n,e){return r(h,i,n).apply(null,e)},this.rejectWith=function(n,e){return r(a,l,n).apply(null,e)},this.notifyWith=function(n,e){return r(p,c,n).apply(null,e)},this},t=function(){var n,e,r,t,o,u,i;if(1===(e=d(arguments)).length)return v(e[0])?e[0]:(new s).resolve(e[0]).promise();if(o=new s,!e.length)return o.resolve().promise();for(t=[],r=l(e.length,function(){return o.resolve.apply(o,t)}),e.forEach(function(n,e){return v(n)?n.done(function(){var n;return n=1<=arguments.length?g.call(arguments,0):[],t[e]=1<n.length?n:n[0],r()}):(t[e]=n,r())}),u=0,i=e.length;u<i;u++)n=e[u],v(n)&&n.fail(o.reject);return o.promise()},n=function(n){return n.Deferred=function(){return new s},n.ajax=i(n.ajax,function(n,e){var r,t,o,u;return null==e&&(e={}),t=new s,r=function(n,r){return i(n,function(){var n,e;return e=arguments[0],n=2<=arguments.length?g.call(arguments,1):[],e&&e.apply(null,n),r.apply(null,n)})},e.success=r(e.success,t.resolve),e.error=r(e.error,t.reject),u=n(e),(o=t.promise()).abort=function(){return u.abort()},o}),n.when=t},"undefined"!=typeof exports?(exports.Deferred=function(){return new s},exports.when=t,exports.installInto=n):"function"==typeof define&&define.amd?define(function(){return"undefined"!=typeof Zepto?n(Zepto):(s.when=t,s.installInto=n,s)}):"undefined"!=typeof Zepto?n(Zepto):(this.Deferred=function(){return new s},this.Deferred.when=t,this.Deferred.installInto=n)}).call(this);